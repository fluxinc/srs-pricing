<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flux Box Pricing</title>
  <script src="config.js"></script>
  <script src="pricing.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0d0d0d;
      color: #f5f5f7;
      line-height: 1.5;
      padding: 2rem;
    }

    .container { max-width: 900px; margin: 0 auto; }

    h1 { font-size: 2rem; font-weight: 600; margin-bottom: 0.5rem; }

    .subtitle { color: #86868b; margin-bottom: 2rem; }

    .controls {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #2c2c2e;
    }

    .control-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 600px) {
      .control-row { grid-template-columns: 1fr; gap: 1rem; }
    }

    label { display: block; font-weight: 500; margin-bottom: 0.5rem; }

    .slider-container { display: flex; align-items: center; gap: 1rem; }

    input[type="range"] {
      flex: 1;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: #3a3a3c;
      border-radius: 4px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: #0a84ff;
      border-radius: 50%;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: #0a84ff;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .slider-value { font-size: 1.25rem; font-weight: 600; min-width: 80px; text-align: right; }

    .discount-summary {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #2c2c2e;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .discount-item { text-align: center; }
    .discount-label { font-size: 0.75rem; color: #86868b; }
    .discount-value { font-size: 1.25rem; font-weight: 600; color: #30d158; }

    .table-container {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid #2c2c2e;
      overflow-x: auto;
      margin-bottom: 1.5rem;
    }

    .table-title { font-weight: 600; margin-bottom: 1rem; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem 1rem; text-align: right; border-bottom: 1px solid #2c2c2e; }
    th { font-weight: 600; color: #86868b; font-size: 0.875rem; }
    th:first-child, td:first-child { text-align: left; }
    tr:last-child td { border-bottom: none; }

    .part-number { font-family: monospace; color: #86868b; font-size: 0.75rem; }
    .price-main { font-size: 1.25rem; font-weight: 600; }
    .price-sub { font-size: 0.875rem; color: #86868b; }
    .discount-badge {
      display: inline-block;
      background: #30d158;
      color: #0d0d0d;
      padding: 0.1rem 0.4rem;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .discount-bar-container {
      width: 100%;
      height: 8px;
      background: #2c2c2e;
      border-radius: 4px;
      margin-top: 0.5rem;
      overflow: hidden;
    }
    .discount-bar {
      height: 100%;
      background: linear-gradient(90deg, #30d158, #34c759);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .footer { margin-top: 2rem; text-align: center; color: #86868b; font-size: 0.875rem; }

    .chart-container {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .chart-title {
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .chart-wrapper {
      position: relative;
      height: 280px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Flux Box Pricing</h1>
    <p class="subtitle">Select your commitment level to see pricing for each contract option</p>

    <div class="controls">
      <div class="control-row">
        <div>
          <label>Monthly Commitment</label>
          <div class="slider-container">
            <input type="range" id="rateSlider" min="10" max="25" step="5" value="10" aria-label="Monthly commitment">
            <span class="slider-value"><span id="rateValue">10</span>/mo</span>
          </div>
        </div>
        <div>
          <label>Commitment Duration</label>
          <div class="slider-container">
            <input type="range" id="durationSlider" min="1" max="10" step="1" value="5" aria-label="Commitment duration">
            <span class="slider-value"><span id="durationValue">5</span> yr</span>
          </div>
        </div>
      </div>
    </div>

    <div class="discount-summary">
      <div class="discount-item">
        <div class="discount-label">Rate Discount</div>
        <div class="discount-value" id="rateDiscount">0%</div>
        <div class="discount-bar-container">
          <div class="discount-bar" id="rateBar" style="width: 0%"></div>
        </div>
      </div>
      <div class="discount-item">
        <div class="discount-label">Duration Discount</div>
        <div class="discount-value" id="durationDiscount">0%</div>
        <div class="discount-bar-container">
          <div class="discount-bar" id="durationBar" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <div class="chart-title">Total Spend: <span id="chartTitle">10-Year Commitment</span></div>
      <div class="chart-subtitle" id="chartSavings" style="color: #30d158; font-size: 0.9rem; margin-bottom: 0.5rem;"></div>
      <div class="chart-wrapper">
        <canvas id="savingsChart"></canvas>
      </div>
    </div>

    <div class="table-container">
      <div class="table-title">Per-Unit Contract Pricing</div>
      <table id="pricingTable">
        <thead>
          <tr>
            <th>Contract</th>
            <th>Year 1</th>
            <th>Year 2+</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="footer" id="footer"></div>
  </div>

  <script>
    const CONTRACT_YEARS = [1, 3, 5, 10];

    function update() {
      const rate = parseInt(document.getElementById('rateSlider').value);
      const duration = parseInt(document.getElementById('durationSlider').value);

      document.getElementById('rateValue').textContent = rate;
      document.getElementById('durationValue').textContent = duration;

      // Discount summary
      const rateDisc = PRICING.rateDiscount(rate);
      const durationDisc = PRICING.durationDiscount(duration);

      document.getElementById('rateDiscount').textContent = PRICING.formatPercent(rateDisc);
      document.getElementById('durationDiscount').textContent = PRICING.formatPercent(durationDisc);

      // Update discount bars (as % of max possible)
      const rateBarPct = (rateDisc / CONFIG.discounts.maxRateDiscount) * 100;
      const durationBarPct = (durationDisc / CONFIG.discounts.maxDurationDiscount) * 100;
      document.getElementById('rateBar').style.width = rateBarPct + '%';
      document.getElementById('durationBar').style.width = durationBarPct + '%';

      // Pricing table
      const tbody = document.querySelector('#pricingTable tbody');
      tbody.innerHTML = '';

      CONTRACT_YEARS.forEach(contractYrs => {
        const y1 = PRICING.year1Price(rate, duration, contractYrs);
        const y2 = PRICING.year2Price(rate, duration, contractYrs);
        const total = PRICING.contractPrice(rate, duration, contractYrs);
        const contractDisc = PRICING.contractDiscount(contractYrs);
        const totalDisc = PRICING.totalDiscount(rate, duration, contractYrs);

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <strong>${contractYrs}-Year</strong><br>
            <span class="part-number">FX-SRS-${contractYrs}YR</span>
            ${contractDisc > 0 ? `<span class="discount-badge">+${Math.round(contractDisc * 100)}% off</span>` : ''}
          </td>
          <td>
            <div class="price-main">${PRICING.formatCurrency(y1)}</div>
          </td>
          <td>
            <div class="price-main">${contractYrs > 1 ? PRICING.formatCurrency(y2) : '—'}</div>
            <div class="price-sub">${contractYrs > 1 ? '/year' : ''}</div>
          </td>
          <td>
            <div class="price-main">${PRICING.formatCurrency(total)}</div>
            <div class="price-sub"><span style="color: #30d158; font-weight: 600;">${PRICING.formatPercent(totalDisc)} off</span></div>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update chart
      updateChart(rate, duration);
    }

    document.getElementById('rateSlider').addEventListener('input', update);
    document.getElementById('durationSlider').addEventListener('input', update);

    // Compute footer from config
    const minRate = parseInt(document.getElementById('rateSlider').min);
    const minRateDisc = PRICING.rateDiscount(minRate);
    document.getElementById('footer').innerHTML = `
      Baseline: ${PRICING.formatCurrency(PRICING.baseline5yr)} per unit (5-year contract with no commitment).<br>
      Commit to ${minRate}/mo minimum = ~${Math.round(minRateDisc * 100)}% off. Higher rate + longer commitment + longer contract = better pricing.
    `;

    // Initialize savings chart
    const ctx = document.getElementById('savingsChart').getContext('2d');
    const savingsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Without Commitment',
            data: [],
            borderColor: '#86868b',
            backgroundColor: 'rgba(134, 134, 139, 0.1)',
            borderWidth: 2,
            fill: false,
            tension: 0.1,
          },
          {
            label: 'With Your Discounts',
            data: [],
            borderColor: '#30d158',
            backgroundColor: 'rgba(48, 209, 88, 0.2)',
            borderWidth: 2,
            fill: '-1',
            tension: 0.1,
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { intersect: false, mode: 'index' },
        plugins: {
          legend: {
            labels: { color: '#f5f5f7', usePointStyle: true }
          },
          tooltip: {
            backgroundColor: '#1c1c1e',
            titleColor: '#f5f5f7',
            bodyColor: '#f5f5f7',
            borderColor: '#3a3a3c',
            borderWidth: 1,
            callbacks: {
              label: ctx => ctx.dataset.label + ': $' + ctx.raw.toLocaleString()
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Year', color: '#86868b' },
            ticks: { color: '#86868b' },
            grid: { color: '#2c2c2e' }
          },
          y: {
            title: { display: true, text: 'Cumulative Spend ($)', color: '#86868b' },
            ticks: { color: '#86868b', callback: v => '$' + v.toLocaleString() },
            grid: { color: '#2c2c2e' }
          }
        }
      }
    });

    function updateChart(rate, duration) {
      const contractYrs = 10; // Using 10-year contracts
      const years = Array.from({ length: duration }, (_, i) => i + 1);
      const unitsPerYear = rate * 12;

      // Baseline price per unit (no commitment discount)
      const baseUnitTotal = PRICING.year1Base + CONFIG.prices.year2 * (contractYrs - 1);

      // Discounted price per unit
      const discUnitTotal = PRICING.contractPrice(rate, duration, contractYrs);

      // Cumulative units purchased over time
      // Year 1: rate*12 units, Year 2: rate*24 units, etc.
      const baselineCumulative = years.map(yr => unitsPerYear * yr * baseUnitTotal);
      const discountedCumulative = years.map(yr => unitsPerYear * yr * discUnitTotal);

      // Total savings
      const totalBaseline = unitsPerYear * duration * baseUnitTotal;
      const totalDiscounted = unitsPerYear * duration * discUnitTotal;
      const totalSavings = totalBaseline - totalDiscounted;
      const savingsPct = ((totalBaseline - totalDiscounted) / totalBaseline * 100).toFixed(0);

      document.getElementById('chartTitle').textContent = `${rate}/mo × ${duration} Years (10-Year Contracts)`;
      document.getElementById('chartSavings').textContent =
        `Total: $${Math.round(totalDiscounted).toLocaleString()} — Save $${Math.round(totalSavings).toLocaleString()} (${savingsPct}% off baseline)`;

      savingsChart.data.labels = years.map(y => 'Year ' + y);
      savingsChart.data.datasets[0].data = baselineCumulative;
      savingsChart.data.datasets[1].data = discountedCumulative;
      savingsChart.update();
    }

    update();
  </script>
</body>
</html>
