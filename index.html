<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flux Mobile SRS Bridge - Fleet Discount Program</title>
  <script src="config.js"></script>
  <script src="pricing.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #222222;
      color: #f5f5f7;
      line-height: 1.5;
      padding: 2rem;
    }

    .container { max-width: 900px; margin: 0 auto; }

    .header { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem; }
    .logo {
      height: 40px;
      width: auto;
    }
    h1 { font-size: 2rem; font-weight: 600; }

    .subtitle { color: #86868b; margin-bottom: 2rem; }
    .tagline { color: #e84200; font-weight: 500; }

    .controls {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #2c2c2e;
    }

    .control-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 1rem;
    }

    @media (max-width: 600px) {
      .control-row { grid-template-columns: 1fr; gap: 1rem; }
    }

    label { display: block; font-weight: 500; margin-bottom: 0.5rem; }

    .slider-container { display: flex; align-items: center; gap: 1rem; }

    input[type="range"] {
      flex: 1;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: #3a3a3c;
      border-radius: 4px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: #e84200;
      border-radius: 50%;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: #e84200;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .slider-value { font-size: 1.25rem; font-weight: 600; min-width: 100px; text-align: right; }

    .contract-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .contract-btn {
      background: #2c2c2e;
      border: 1px solid #3a3a3c;
      color: #f5f5f7;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s;
    }
    .contract-btn:hover { background: #3a3a3c; }
    .contract-btn.active {
      background: #e84200;
      border-color: #e84200;
      font-weight: 600;
    }

    .discount-highlight {
      background: linear-gradient(135deg, #1a3a1a 0%, #1c1c1e 100%);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #2d5a2d;
      text-align: center;
    }

    .discount-title {
      font-size: 0.875rem;
      color: #86868b;
      margin-bottom: 0.5rem;
    }

    .discount-amount {
      font-size: 2.5rem;
      font-weight: 700;
      color: #4ade80;
    }

    .discount-subtitle {
      font-size: 0.875rem;
      color: #86868b;
      margin-top: 0.5rem;
    }

    .discount-breakdown {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .discount-item {
      text-align: center;
    }

    .discount-label {
      font-size: 0.75rem;
      color: #86868b;
    }

    .discount-value {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .discount-value.active { color: #4ade80; }

    .table-container {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid #2c2c2e;
      overflow-x: auto;
      margin-bottom: 1.5rem;
    }

    .table-title { font-weight: 600; margin-bottom: 1rem; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem 1rem; text-align: right; border-bottom: 1px solid #2c2c2e; }
    th { font-weight: 600; color: #86868b; font-size: 0.875rem; }
    th:first-child, td:first-child { text-align: left; }
    tr:last-child td { border-bottom: none; }

    .part-number { font-family: monospace; color: #e84200; font-size: 1rem; font-weight: 600; }
    .price-main { font-size: 1.25rem; font-weight: 600; }
    .price-sub { font-size: 0.875rem; color: #86868b; }
    .discount-badge {
      display: inline-block;
      background: #e84200;
      color: #222222;
      padding: 0.1rem 0.4rem;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .fleet-tiers-table {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid #2c2c2e;
      margin-bottom: 1.5rem;
    }

    .fleet-tiers-table table {
      width: 100%;
    }

    .fleet-tiers-table th {
      text-align: left;
      padding: 0.5rem;
    }

    .fleet-tiers-table td {
      padding: 0.5rem;
    }

    .fleet-tiers-table tr.current-tier {
      background: rgba(74, 222, 128, 0.1);
    }

    .fleet-tiers-table .tier-marker {
      color: #4ade80;
      font-weight: 600;
    }

    .chart-container {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .chart-title {
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .chart-wrapper {
      position: relative;
      height: 280px;
    }

    .footer { margin-top: 2rem; text-align: center; color: #86868b; font-size: 0.875rem; }

    .pitch-section {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #2c2c2e;
    }

    .pitch-section h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: #e84200;
    }

    .pitch-section p {
      color: #a1a1a6;
      margin-bottom: 0.75rem;
    }

    .pitch-section ul {
      list-style: none;
      padding-left: 0;
    }

    .pitch-section li {
      padding: 0.25rem 0;
      color: #a1a1a6;
    }

    .pitch-section li::before {
      content: "-> ";
      color: #e84200;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="logo.png" alt="Flux" class="logo">
      <h1>Flux Mobile SRS Bridge</h1>
    </div>
    <p class="subtitle">
      <span class="tagline">Volume Discount Program: "Commit More, Save More"</span>
    </p>

    <div class="controls">
      <div class="control-row">
        <div>
          <label>Monthly Order Rate (units/mo)</label>
          <div class="slider-container">
            <input type="range" id="rateSlider" min="10" max="25" step="5" value="10" aria-label="Monthly order rate">
            <span class="slider-value"><span id="rateValue">10</span>/mo</span>
          </div>
        </div>
        <div>
          <label>Commitment Duration (years)</label>
          <div class="slider-container">
            <input type="range" id="durationSlider" min="1" max="10" step="1" value="4" aria-label="Commitment duration">
            <span class="slider-value"><span id="durationValue">4</span> yr</span>
          </div>
        </div>
      </div>
      <div class="control-row">
        <div>
          <label>Total Commitment: <span id="totalCommitment" style="color: #e84200; font-weight: 600;">480 units</span></label>
        </div>
        <div>
          <label>Contract Length (per unit)</label>
          <div class="contract-buttons" id="contractButtons">
            <button class="contract-btn" data-years="1">1-Year</button>
            <button class="contract-btn" data-years="3">3-Year</button>
            <button class="contract-btn active" data-years="5">5-Year</button>
            <button class="contract-btn" data-years="10">10-Year</button>
          </div>
        </div>
      </div>
    </div>

    <div class="table-container">
      <div class="table-title">Per-Unit Pricing by Part Number</div>
      <table id="pricingTable">
        <thead>
          <tr>
            <th>Part Number</th>
            <th>Year 1</th>
            <th>Year 2+ (per yr)</th>
            <th>Total Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="discount-highlight">
      <div class="discount-title">Your Total Year 2+ Discount (<span id="totalUnitsDisplay">480</span> units committed)</div>
      <div class="discount-amount" id="totalY2Discount">30%</div>
      <div class="discount-subtitle">
        Y2+ Price: <span id="y2PriceDisplay">$1,100</span>/unit/year (base: $1,550)
      </div>
      <div class="discount-breakdown">
        <div class="discount-item">
          <div class="discount-label">Volume (Y2+)</div>
          <div class="discount-value active" id="volumeDiscValue">25%</div>
        </div>
        <div class="discount-item">
          <div class="discount-label">Contract</div>
          <div class="discount-value" id="contractDiscValue">5%</div>
        </div>
      </div>
    </div>

    <div class="fleet-tiers-table">
      <div class="table-title">Volume Commitment Discount Tiers</div>
      <table id="volumeTiersTable">
        <thead>
          <tr>
            <th>Total Commitment</th>
            <th>Volume Discount</th>
            <th>Y1 Discount</th>
            <th>Example Y2+ Price</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="chart-container">
      <div class="chart-title">Total Contract Price by Commitment Level</div>
      <div class="chart-wrapper">
        <canvas id="priceChart"></canvas>
      </div>
    </div>

    <div class="pitch-section">
      <h2>How Your Discounts Work</h2>
      <p>Your pricing is based on two simple factors:</p>
      <ul>
        <li><strong>Volume Commitment:</strong> Total units = monthly rate × 12 × years. Higher commitments unlock deeper discounts (Y1 gets 50% of volume discount, Y2+ gets full discount)</li>
        <li><strong>Contract Length:</strong> Longer per-unit contracts (1/3/5/10 year) reduce pricing</li>
      </ul>
      <p style="margin-top: 1rem;"><strong>The more you commit upfront, the more you save across the entire deal.</strong></p>
    </div>

    <div class="footer" id="footer"></div>
  </div>

  <script>
    const CONTRACT_YEARS = [1, 3, 5, 10];
    let selectedContract = 5;
    let priceChart = null;

    function update() {
      const rate = parseInt(document.getElementById('rateSlider').value);
      const duration = parseInt(document.getElementById('durationSlider').value);

      // Total commitment = rate × 12 × duration
      const totalUnits = PRICING.totalCommitment(rate, duration);

      document.getElementById('rateValue').textContent = rate;
      document.getElementById('durationValue').textContent = duration;
      document.getElementById('totalCommitment').textContent = totalUnits + ' units';

      // Get discount breakdown
      const discounts = PRICING.getDiscountBreakdown(rate, duration, selectedContract);

      // Display discount breakdown
      document.getElementById('volumeDiscValue').textContent = Math.round(discounts.volume * 100) + '%';
      document.getElementById('contractDiscValue').textContent = Math.round(discounts.contract * 100) + '%';

      // Highlight active discounts
      document.getElementById('volumeDiscValue').className = 'discount-value' + (discounts.volume > 0 ? ' active' : '');
      document.getElementById('contractDiscValue').className = 'discount-value' + (discounts.contract > 0 ? ' active' : '');

      // Total Y2+ discount and price
      const totalY2Disc = discounts.totalY2;
      const y2Price = PRICING.year2Price(rate, duration, selectedContract);
      document.getElementById('totalY2Discount').textContent = Math.round(totalY2Disc * 100) + '%';
      document.getElementById('y2PriceDisplay').textContent = PRICING.formatCurrency(y2Price);
      document.getElementById('totalUnitsDisplay').textContent = totalUnits;

      // Volume tiers table
      const volumeTbody = document.querySelector('#volumeTiersTable tbody');
      volumeTbody.innerHTML = '';

      const tiers = [
        { label: '0-119 units', min: 0, max: 119 },
        { label: '120-239 units', min: 120, max: 239 },
        { label: '240-359 units', min: 240, max: 359 },
        { label: '360-499 units', min: 360, max: 499 },
        { label: '500+ units', min: 500, max: Infinity },
      ];

      tiers.forEach(tier => {
        const volumeDisc = PRICING.volumeDiscount(tier.min);
        const y1VolumeDisc = volumeDisc * CONFIG.discounts.year1VolumeFactor;
        const exampleY2Price = PRICING.roundUp50(CONFIG.prices.year2 * (1 - volumeDisc - discounts.contract));
        const isCurrent = totalUnits >= tier.min && totalUnits <= tier.max;

        const row = document.createElement('tr');
        if (isCurrent) row.classList.add('current-tier');

        row.innerHTML = `
          <td>${isCurrent ? '<span class="tier-marker">-></span> ' : ''}${tier.label}</td>
          <td>${Math.round(volumeDisc * 100)}%</td>
          <td>${Math.round(y1VolumeDisc * 100)}%</td>
          <td>${PRICING.formatCurrency(exampleY2Price)}/year</td>
        `;
        volumeTbody.appendChild(row);
      });

      // Pricing table
      const tbody = document.querySelector('#pricingTable tbody');
      tbody.innerHTML = '';

      CONTRACT_YEARS.forEach(contractYrs => {
        const y1 = PRICING.year1Price(rate, duration, contractYrs);
        const y2 = PRICING.year2Price(rate, duration, contractYrs);
        const totalContract = y1 + (y2 * Math.max(0, contractYrs - 1));
        const y1Disc = PRICING.year1TotalDiscount(rate, duration, contractYrs);
        const y2Disc = PRICING.year2TotalDiscount(rate, duration, contractYrs);

        const row = document.createElement('tr');
        const isSelected = contractYrs === selectedContract;
        if (isSelected) row.style.background = 'rgba(232, 66, 0, 0.1)';

        row.innerHTML = `
          <td>
            <span class="part-number">FX-SRS-${contractYrs}YR</span>
          </td>
          <td>
            <div class="price-main">${PRICING.formatCurrency(y1)}</div>
            <div class="price-sub">${y1Disc > 0 ? Math.round(y1Disc * 100) + '% off' : 'no discount'}</div>
          </td>
          <td>
            <div class="price-main">${contractYrs > 1 ? PRICING.formatCurrency(y2) : '-'}</div>
            <div class="price-sub">${contractYrs > 1 ? (y2Disc > 0 ? Math.round(y2Disc * 100) + '% off' : 'no discount') : ''}</div>
          </td>
          <td>
            <div class="price-main">${PRICING.formatCurrency(totalContract)}</div>
            <div class="price-sub">${contractYrs} year total</div>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update chart
      updateChart(rate, duration, totalUnits);

      // Footer
      const nextTier = PRICING.getNextVolumeTier(totalUnits);
      let footerText = `${rate}/mo × ${duration} years = ${totalUnits} units committed. `;
      if (nextTier) {
        const unitsNeeded = nextTier.minUnits - totalUnits;
        footerText += `${unitsNeeded} more units unlocks ${Math.round(nextTier.discount * 100)}% volume discount.`;
      } else {
        footerText += 'Maximum volume discount tier achieved!';
      }
      document.getElementById('footer').textContent = footerText;
    }

    // Contract button handlers
    document.querySelectorAll('.contract-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.contract-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedContract = parseInt(btn.dataset.years);
        update();
      });
    });

    document.getElementById('rateSlider').addEventListener('input', update);
    document.getElementById('durationSlider').addEventListener('input', update);

    // Initialize price chart - shows total contract price by commitment level
    const ctx = document.getElementById('priceChart').getContext('2d');
    priceChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['120', '240', '360', '480', '500', '600'],
        datasets: [
          {
            label: 'Total Contract Price',
            data: [],
            borderColor: '#e84200',
            backgroundColor: 'rgba(232, 66, 0, 0.1)',
            fill: true,
            tension: 0.3,
            pointRadius: 4,
            pointBackgroundColor: '#e84200',
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: '#1c1c1e',
            titleColor: '#f5f5f7',
            bodyColor: '#f5f5f7',
            borderColor: '#3a3a3c',
            borderWidth: 1,
            callbacks: {
              label: ctx => 'Total: $' + ctx.raw.toLocaleString()
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Total Commitment (units)', color: '#86868b' },
            ticks: { color: '#86868b' },
            grid: { color: '#2c2c2e' }
          },
          y: {
            title: { display: true, text: 'Contract Price per Unit ($)', color: '#86868b' },
            ticks: { color: '#86868b', callback: v => '$' + v },
            grid: { color: '#2c2c2e' }
          }
        }
      }
    });

    function updateChart(rate, duration, currentCommitment) {
      if (!priceChart) return;

      // Show contract prices at different commitment levels
      const commitmentLevels = [120, 240, 360, 480, 500, 600];
      const prices = commitmentLevels.map(units => {
        // Calculate rate and duration that would give this commitment
        const tempRate = 10;
        const tempDuration = units / (tempRate * 12);
        return PRICING.contractPrice(tempRate, tempDuration, selectedContract);
      });

      priceChart.data.datasets[0].data = prices;

      // Highlight current commitment position
      const currentIdx = commitmentLevels.findIndex((c, i) => {
        const next = commitmentLevels[i + 1] || Infinity;
        return currentCommitment >= c && currentCommitment < next;
      });
      priceChart.data.datasets[0].pointRadius = commitmentLevels.map((c, i) => {
        if (i === currentIdx || (currentIdx === -1 && c >= currentCommitment)) return 8;
        return 4;
      });

      priceChart.update();
    }

    // Initialize
    update();
  </script>
</body>
</html>
